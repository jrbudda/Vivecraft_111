--- a/net/minecraft/client/Minecraft.java
+++ b/net/minecraft/client/Minecraft.java
@@ -13,6 +13,8 @@
 import com.mojang.authlib.minecraft.MinecraftSessionService;
 import com.mojang.authlib.properties.PropertyMap;
 import com.mojang.authlib.yggdrasil.YggdrasilAuthenticationService;
+import com.mtbs3d.minecrift.render.PlayerModelController;
+
 import java.awt.image.BufferedImage;
 import java.io.File;
 import java.io.IOException;
@@ -199,6 +201,8 @@
 import org.lwjgl.opengl.OpenGLException;
 import org.lwjgl.opengl.PixelFormat;
 import org.lwjgl.util.glu.GLU;
+import net.minecraft.src.Reflector;
+import net.minecraft.src.ReflectorMethod;
 
 public class Minecraft implements IThreadListener, ISnooperInfo
 {
@@ -236,7 +240,7 @@
 
     /** True if the player is connected to a realms server */
     private boolean connectedToRealms;
-    private final Timer timer = new Timer(20.0F);
+    public final Timer timer = new Timer(20.0F);
 
     /** Instance of PlayerUsageSnooper. */
     private final Snooper usageSnooper = new Snooper("client", this, MinecraftServer.getCurrentTimeMillis());
@@ -341,7 +345,7 @@
     private long debugCrashKeyPressTime = -1L;
     private IReloadableResourceManager mcResourceManager;
     private final MetadataSerializer metadataSerializer_ = new MetadataSerializer();
-    private final List<IResourcePack> defaultResourcePacks = Lists.<IResourcePack>newArrayList();
+    public final List<IResourcePack> defaultResourcePacks = Lists.<IResourcePack>newArrayList();
     private final DefaultResourcePack mcDefaultResourcePack;
     private ResourcePackRepository mcResourcePackRepository;
     private LanguageManager mcLanguageManager;
@@ -509,6 +513,7 @@
         this.setWindowIcon();
         this.setInitialDisplayMode();
         this.createDisplay();
+        Display.setTitle(this.minecriftVerString);
         OpenGlHelper.initializeTextures();
         this.framebufferMc = new Framebuffer(this.displayWidth, this.displayHeight, true);
         this.framebufferMc.setFramebufferColor(0.0F, 0.0F, 0.0F, 0.0F);
@@ -517,9 +522,32 @@
         this.mcResourceManager = new SimpleReloadableResourceManager(this.metadataSerializer_);
         this.mcLanguageManager = new LanguageManager(this.metadataSerializer_, this.gameSettings.language);
         this.mcResourceManager.registerReloadListener(this.mcLanguageManager);
+        //Forge
+        Object fmlClientHandler = null;
+		if( Reflector.FMLClientHandler_instance.exists())
+		{
+			fmlClientHandler = Reflector.call( Reflector.FMLClientHandler_instance);
+		}
+		if( fmlClientHandler != null)
+		{
+			Reflector.callVoid(fmlClientHandler, Reflector.FMLClientHandler_beginMinecraftLoading, new Object[] {this, this.defaultResourcePacks,this.mcResourceManager, this.metadataSerializer_});
+		}
+		else {
+			this.refreshResources();
+		}
+		//
         this.refreshResources();
         this.renderEngine = new TextureManager(this.mcResourceManager);
         this.mcResourceManager.registerReloadListener(this.renderEngine);
+		//Forge
+        boolean hasForge = Reflector.forgeExists();
+		if (hasForge) {
+			Reflector.callVoid(Reflector.SplashProgress_drawVanillaScreen, this.renderEngine);
+		}
+		else {
+			this.drawSplashScreen(this.renderEngine);
+		}
+		//
         this.drawSplashScreen(this.renderEngine);
         this.skinManager = new SkinManager(this.renderEngine, new File(this.fileAssets, "skins"), this.sessionService);
         this.saveLoader = new AnvilSaveConverter(new File(this.mcDataDir, "saves"), this.dataFixer);
@@ -539,6 +567,15 @@
         this.mcResourceManager.registerReloadListener(this.standardGalacticFontRenderer);
         this.mcResourceManager.registerReloadListener(new GrassColorReloadListener());
         this.mcResourceManager.registerReloadListener(new FoliageColorReloadListener());
+        
+         
+        Object bar = null;
+        if (hasForge) {
+        	bar = Reflector.call(Reflector.FMLCommonProgressManager_push, "Rendering Setup", 5, true);
+        	Reflector.callVoid(bar, Reflector.FMLCommonProgressManager_ProgressBar_step, "Loading Render Manager");
+        }
+        
+        
         AchievementList.OPEN_INVENTORY.setStatStringFormatter(new IStatStringFormat()
         {
             public String formatString(String str)
@@ -567,19 +604,30 @@
         GlStateManager.loadIdentity();
         GlStateManager.matrixMode(5888);
         this.checkGLError("Startup");
+		if (hasForge) Reflector.callVoid(bar, Reflector.FMLCommonProgressManager_ProgressBar_step, "Loading Texture Map");
+
         this.textureMapBlocks = new TextureMap("textures");
         this.textureMapBlocks.setMipmapLevels(this.gameSettings.mipmapLevels);
         this.renderEngine.loadTickableTexture(TextureMap.LOCATION_BLOCKS_TEXTURE, this.textureMapBlocks);
         this.renderEngine.bindTexture(TextureMap.LOCATION_BLOCKS_TEXTURE);
         this.textureMapBlocks.setBlurMipmapDirect(false, this.gameSettings.mipmapLevels > 0);
+		if (hasForge) Reflector.callVoid(bar, Reflector.FMLCommonProgressManager_ProgressBar_step, "Loading Model Manager");
+
         this.modelManager = new ModelManager(this.textureMapBlocks);
         this.mcResourceManager.registerReloadListener(this.modelManager);
         this.blockColors = BlockColors.init();
         this.itemColors = ItemColors.init(this.blockColors);
         this.renderItem = new RenderItem(this.renderEngine, this.modelManager, this.itemColors);
         this.renderManager = new RenderManager(this.renderEngine, this.renderItem);
+		if (hasForge) Reflector.callVoid(bar, Reflector.FMLCommonProgressManager_ProgressBar_step, "Loading Item Renderer");
+
         this.itemRenderer = new ItemRenderer(this);
         this.mcResourceManager.registerReloadListener(this.renderItem);
+		if (hasForge){
+			Reflector.callVoid(bar, Reflector.FMLCommonProgressManager_ProgressBar_step, "Loading Item Renderer");
+			Reflector.callVoid(Reflector.SplashProgress_pause);
+		}
+
         this.entityRenderer = new EntityRenderer(this, this.mcResourceManager);
         this.mcResourceManager.registerReloadListener(this.entityRenderer);
         this.blockRenderDispatcher = new BlockRendererDispatcher(this.modelManager.getBlockModelShapes(), this.blockColors);
@@ -589,20 +637,54 @@
         this.guiAchievement = new GuiAchievement(this);
         GlStateManager.viewport(0, 0, this.displayWidth, this.displayHeight);
         this.effectRenderer = new ParticleManager(this.world, this.renderEngine);
+        //Forge
+        if (hasForge){
+        	Reflector.callVoid(Reflector.SplashProgress_resume);
+        	Reflector.call(Reflector.FMLCommonProgressManager_pop, bar);
+        	Reflector.callVoid(fmlClientHandler, Reflector.FMLClientHandler_finishMinecraftLoading);
+        } else {
+        	this.refreshResources();
+        }
+    
         this.checkGLError("Post startup");
-        this.ingameGUI = new GuiIngame(this);
+        
+		if(hasForge)
+		{
+			this.ingameGUI = (GuiIngame)Reflector.newInstance(Reflector.ForgeGuiIngame_Constructor, this);
+		}
+		else
+		{
+			this.ingameGUI = new GuiIngame(this);
+		}
+	    //
 
         if (this.serverName != null)
-        {
-            this.displayGuiScreen(new GuiConnecting(new GuiMainMenu(), this, this.serverName, this.serverPort));
-        }
+        {        	//Forge
+			if( fmlClientHandler != null ) {
+				Reflector.callVoid(fmlClientHandler, Reflector.FMLClientHandler_connectToServerAtStartup, new Object[]{this.serverName, this.serverPort});
+			}
+			else {
+				this.displayGuiScreen(new GuiConnecting(new GuiMainMenu(), this, this.serverName, this.serverPort));
+			}
+			//
+		}
         else
         {
             this.displayGuiScreen(new GuiMainMenu());
         }
 
-        this.renderEngine.deleteTexture(this.mojangLogo);
-        this.mojangLogo = null;
+        //Forge
+		if (hasForge) {
+			Reflector.callVoid(Reflector.SplashProgress_clearVanillaResources, new Object[] {renderEngine, mojangLogo});
+		}
+		else {
+			this.renderEngine.deleteTexture(this.mojangLogo);
+		}      
+		//
+		if( hasForge ) {
+			Reflector.callVoid(fmlClientHandler, Reflector.FMLClientHandler_onInitializationComplete);
+		}
+		this.mojangLogo = null;
         this.loadingScreen = new LoadingScreenRenderer(this);
         this.debugRenderer = new DebugRenderer(this);
 
@@ -787,22 +869,30 @@
         File file1 = new File(getMinecraft().mcDataDir, "crash-reports");
         File file2 = new File(file1, "crash-" + (new SimpleDateFormat("yyyy-MM-dd_HH.mm.ss")).format(new Date()) + "-client.txt");
         Bootstrap.printToSYSOUT(crashReportIn.getCompleteReport());
-
+        int retVal;
+        
         if (crashReportIn.getFile() != null)
         {
             Bootstrap.printToSYSOUT("#@!@# Game crashed! Crash report saved to: #@!@# " + crashReportIn.getFile());
-            System.exit(-1);
+            retVal = -1;
         }
         else if (crashReportIn.saveToFile(file2))
         {
             Bootstrap.printToSYSOUT("#@!@# Game crashed! Crash report saved to: #@!@# " + file2.getAbsolutePath());
-            System.exit(-1);
+            retVal = -1;
         }
         else
         {
             Bootstrap.printToSYSOUT("#@?@# Game crashed! Crash report could not be saved. #@?@#");
-            System.exit(-2);
+            retVal = -2;
         }
+        
+        if(Reflector.forgeExists()){
+        	Object object = Reflector.call(Reflector.FMLCommonHandler_instance);
+            Reflector.call(object, Reflector.FMLCommonHandler_handleExit, new Object[] {retVal});
+        } else
+        	System.exit(retVal);
+        
     }
 
     public boolean isUnicode()
@@ -921,7 +1011,7 @@
         this.displayHeight = displaymode.getHeight();
     }
 
-    private void drawSplashScreen(TextureManager textureManagerInstance) throws LWJGLException
+    public void drawSplashScreen(TextureManager textureManagerInstance) throws LWJGLException
     {
         ScaledResolution scaledresolution = new ScaledResolution(this);
         int i = scaledresolution.getScaleFactor();
@@ -1004,7 +1094,8 @@
      */
     public void displayGuiScreen(@Nullable GuiScreen guiScreenIn)
     {
-        if (this.currentScreen != null)
+    	
+        if (Reflector.forgeExists() == false && this.currentScreen != null)
         {
             this.currentScreen.onGuiClosed();
         }
@@ -1023,6 +1114,22 @@
             this.gameSettings.showDebugInfo = false;
             this.ingameGUI.getChatGUI().clearChatMessages(true);
         }
+        
+        if (Reflector.forgeExists())
+        {
+        	GuiScreen old = this.currentScreen;
+        	Object event = Reflector.newInstance(Reflector.ForgeGuiOpenEvent_Constructor, new Object[] {guiScreenIn});
+
+        	if (Reflector.postForgeBusEvent(event)) return;
+
+        	guiScreenIn = (GuiScreen)Reflector.getFieldValue(event, Reflector.ForgeGuiOpenEvent_gui);
+        	if (old != null && guiScreenIn != old)
+        	{
+        		old.onGuiClosed();
+        	}
+        }
+
+
 
         this.currentScreen = (GuiScreen)guiScreenIn;
 
@@ -1163,9 +1270,21 @@
 
         if (!this.skipRenderWorld)
         {
-            this.mcProfiler.endStartSection("gameRenderer");
-            this.entityRenderer.updateCameraAndRender(this.timer.renderPartialTicks, i);
-            this.mcProfiler.endSection();
+
+        	Object fmlCommonHandler = null;
+        	if (Reflector.FMLCommonHandler_instance.exists()) {
+        		fmlCommonHandler = Reflector.call(Reflector.FMLCommonHandler_instance);
+        		Reflector.callVoid(fmlCommonHandler, Reflector.FMLCommonHandler_onRenderTickStart, new Object[]{this.timer.renderPartialTicks});
+        	}
+
+        	this.mcProfiler.endStartSection("gameRenderer");
+        	this.entityRenderer.updateCameraAndRender(this.timer.renderPartialTicks, i);
+        	this.mcProfiler.endSection();
+
+
+        	if (fmlCommonHandler != null) {
+        		Reflector.callVoid(fmlCommonHandler, Reflector.FMLCommonHandler_onRenderTickEnd, new Object[]{this.timer.renderPartialTicks});		
+        	}
         }
 
         this.mcProfiler.endSection();
@@ -1527,10 +1646,16 @@
             {
                 BlockPos blockpos = this.objectMouseOver.getBlockPos();
 
-                if (this.world.getBlockState(blockpos).getMaterial() != Material.AIR && this.playerController.onPlayerDamageBlock(blockpos, this.objectMouseOver.sideHit))
+                //Forge changes this from a material check to isAirBlock...
+                if (!this.world.isAirBlock(blockpos) && this.playerController.onPlayerDamageBlock(blockpos, this.objectMouseOver.sideHit))
                 {
-                    this.effectRenderer.addBlockHitEffects(blockpos, this.objectMouseOver.sideHit);
-                    this.player.swingArm(EnumHand.MAIN_HAND);
+                	if(Reflector.forgeExists())
+                		//y u gotta be different?
+                		Reflector.call(this.effectRenderer, Reflector.ForgeParticleManager_addBlockHitEffects, blockpos, this.objectMouseOver);
+                	else
+                		this.effectRenderer.addBlockHitEffects(blockpos, this.objectMouseOver.sideHit);
+                	
+                	this.player.swingArm(EnumHand.MAIN_HAND);
                 }
             }
             else
@@ -1577,6 +1702,9 @@
                         }
 
                         this.player.resetCooldown();
+                    	if(Reflector.forgeExists())
+                       	   Reflector.callVoid(Reflector.ForgeHooks_onEmptyLeftClick, this.player);
+
                 }
 
                 this.player.swingArm(EnumHand.MAIN_HAND);
@@ -1626,7 +1754,7 @@
                             case BLOCK:
                                 BlockPos blockpos = this.objectMouseOver.getBlockPos();
 
-                                if (this.world.getBlockState(blockpos).getMaterial() != Material.AIR)
+                                if (!this.world.isAirBlock(blockpos)) //Forge DOES NOT change this to isairblock but it prolly is supposed to... right?
                                 {
                                     int i = itemstack.getCount();
                                     EnumActionResult enumactionresult = this.playerController.processRightClickBlock(this.player, this.world, blockpos, this.objectMouseOver.sideHit, this.objectMouseOver.hitVec, enumhand);
@@ -1634,6 +1762,9 @@
                                     if (enumactionresult == EnumActionResult.SUCCESS)
                                     {
                                         this.player.swingArm(enumhand);
+                                        if(Reflector.forgeExists())
+                                        	if (itemstack.isEmpty() && (this.objectMouseOver == null || this.objectMouseOver.typeOfHit == RayTraceResult.Type.MISS)) 
+                                        		Reflector.callVoid(Reflector.ForgeHooks_onEmptyClick,this.player, enumhand);
 
                                         if (!itemstack.isEmpty() && (itemstack.getCount() != i || this.playerController.isInCreativeMode()))
                                         {
@@ -1721,7 +1852,7 @@
     /**
      * Called to resize the current screen.
      */
-    private void resize(int width, int height)
+    public void resize(int width, int height)
     {
         this.displayWidth = Math.max(1, width);
         this.displayHeight = Math.max(1, height);
@@ -1763,7 +1894,12 @@
         {
             --this.rightClickDelayTimer;
         }
-
+        Object fmlCommonHandler = null;
+        boolean hasForge = Reflector.forgeExists();
+		if( hasForge) {
+			fmlCommonHandler = Reflector.call( Reflector.FMLCommonHandler_instance);
+			Reflector.callVoid(fmlCommonHandler, Reflector.FMLCommonHandler_onPreClientTick);
+		}
         this.mcProfiler.startSection("gui");
 
         if (!this.isGamePaused)
@@ -1875,6 +2011,9 @@
                     this.joinPlayerCounter = 0;
                     this.world.joinEntityInSurroundings(this.player);
                 }
+                if(hasForge)
+                	Reflector.callVoid(fmlCommonHandler, Reflector.FMLCommonHandler_fireMouseInput);
+
             }
 
             this.mcProfiler.endStartSection("gameRenderer");
@@ -1908,6 +2047,8 @@
             this.entityRenderer.stopUseShader();
         }
 
+        PlayerModelController.getInstance().tick();
+        
         if (!this.isGamePaused)
         {
             this.mcMusicTicker.update();
@@ -1963,6 +2104,9 @@
         }
 
         this.mcProfiler.endSection();
+        if(hasForge)
+        	Reflector.callVoid(fmlCommonHandler, Reflector.FMLCommonHandler_onPostClientTick);
+
         this.systemTime = getSystemTime();
     }
 
@@ -2068,6 +2212,10 @@
                     }
                 }
             }
+            //Forge
+            if(Reflector.forgeExists())
+            	Reflector.callVoid(Reflector.call( Reflector.FMLCommonHandler_instance), Reflector.FMLCommonHandler_fireKeyInput);
+            //
         }
 
         this.processKeyBinds();
@@ -2314,6 +2462,10 @@
     {
         while (Mouse.next())
         {
+			if (Reflector.forgeExists()) {
+				if (Reflector.callBoolean(Reflector.ForgeHooksClient_postMouseEvent)) continue;
+			}
+			
             int i = Mouse.getEventButton();
             KeyBinding.setKeyBindState(i - 100, Mouse.getEventButtonState());
 
@@ -2424,6 +2576,16 @@
 
         while (!this.theIntegratedServer.serverIsInRunLoop())
         {
+        	if (Reflector.forgeExists())
+        	{
+        		if (!Reflector.callBoolean(Reflector.FMLStartupQuery_check))
+        		{
+        			loadWorld(null);
+        			displayGuiScreen(null);
+        			return;
+        		}
+        	}
+
             String s = this.theIntegratedServer.getUserMessage();
 
             if (s != null)
@@ -2449,7 +2611,15 @@
         SocketAddress socketaddress = this.theIntegratedServer.getNetworkSystem().addLocalEndpoint();
         NetworkManager networkmanager = NetworkManager.provideLocalClient(socketaddress);
         networkmanager.setNetHandler(new NetHandlerLoginClient(networkmanager, this, (GuiScreen)null));
+        if(Reflector.forgeExists())
+        	if (!Reflector.callBoolean(this.getSession(), Reflector.ForgeSession_hasCachedProperties))
+        	{
+        		com.mojang.authlib.GameProfile gameProfile = this.getSession().getProfile();
+        		gameProfile = sessionService.fillProfileProperties(gameProfile, true); //Forge: Fill profile properties upon game load. Fixes MC-52974.
+        		Reflector.call(this.getSession(), Reflector.ForgeSession_setProperties, new Object[]{gameProfile.getProperties()});
+        	}
         networkmanager.sendPacket(new C00Handshake(316, socketaddress.toString(), 0, EnumConnectionState.LOGIN));
+
         networkmanager.sendPacket(new CPacketLoginStart(this.getSession().getProfile()));
         this.myNetworkManager = networkmanager;
     }
@@ -2467,6 +2637,10 @@
      */
     public void loadWorld(@Nullable WorldClient worldClientIn, String loadingMessage)
     {
+		if (this.world != null && Reflector.EventBus.exists())
+		{
+			Reflector.postForgeBusEvent(Reflector.ForgeWorldEvent_Unload_Constructor, this.world);
+		}
         if (worldClientIn == null)
         {
             NetHandlerPlayClient nethandlerplayclient = this.getConnection();
@@ -2478,7 +2652,23 @@
 
             if (this.theIntegratedServer != null && this.theIntegratedServer.isAnvilFileSet())
             {
-                this.theIntegratedServer.initiateShutdown();
+            	this.theIntegratedServer.initiateShutdown();
+            	//Forge
+            	if(Reflector.forgeExists()){
+            		if (loadingScreen != null && this.running)
+            		{
+            			this.loadingScreen.displayLoadingString(I18n.format("forge.client.shutdown.internal"));
+            		}
+            		while (!theIntegratedServer.isServerStopped())
+            		{
+            			try
+            			{
+            				Thread.sleep(10);
+            			}
+            			catch (InterruptedException ie) {}
+            		}
+            	}
+            	//
             }
 
             this.theIntegratedServer = null;
@@ -2502,6 +2692,11 @@
             this.ingameGUI.resetPlayersOverlayFooterHeader();
             this.setServerData((ServerData)null);
             this.integratedServerIsRunning = false;
+			//Forge
+            if(Reflector.forgeExists()) {
+				Reflector.callVoid(Reflector.call( Reflector.FMLClientHandler_instance), Reflector.FMLClientHandler_handleClientWorldClosing, new Object[]{this.world});
+			}
+            //
         }
 
         this.mcSoundHandler.stopSounds();
@@ -2626,6 +2821,12 @@
      */
     private void middleClickMouse()
     {
+    	if(Reflector.forgeExists()){
+    		if (Reflector.callBoolean(Reflector.ForgeHooks_onPickBlock, new Object[]{this.objectMouseOver,this.player,this.world}))
+    		{
+    			return;
+    		}
+    	}
         if (this.objectMouseOver != null && this.objectMouseOver.typeOfHit != RayTraceResult.Type.MISS)
         {
             boolean flag = this.player.capabilities.isCreativeMode;
@@ -2789,7 +2990,7 @@
         }
     }
 
-    private ItemStack storeTEInStack(ItemStack stack, TileEntity te)
+    public ItemStack storeTEInStack(ItemStack stack, TileEntity te)
     {
         NBTTagCompound nbttagcompound = te.writeToNBT(new NBTTagCompound());
 
@@ -3100,6 +3301,10 @@
      */
     public static int getGLMaximumTextureSize()
     {
+    	//Forge
+    	if(Reflector.forgeExists())
+    		return Reflector.callInt(Reflector.SplashProgress_getMaxTextureSize);
+    	//
         for (int i = 16384; i > 0; i >>= 1)
         {
             GlStateManager.glTexImage2D(32868, 0, 6408, i, i, 0, 6408, 5121, (IntBuffer)null);
@@ -3419,4 +3624,19 @@
     {
         return this.player != null && this.player.hasReducedDebug() || this.gameSettings.reducedDebugInfo;
     }
+    
+	public void printChatMessage(String msg)
+	{
+		if (this.world != null) {
+			ITextComponent chatText = new TextComponentString(msg);
+			this.ingameGUI.getChatGUI().printChatMessage(chatText);
+		}
+	}
+    public final String minecriftVerString = "Vivecraft 1.11.2-NONVR Companion-7r7";
+	// FORGE
+	public ItemColors getItemColors()
+	{
+		return this.itemColors;
+	}
+
 }
